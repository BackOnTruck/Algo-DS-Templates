### 虚树

虚树通常用于一类树的询问: 每次询问给定一些点, 求一些值.

虚树的主要思路: 每次询问提取出我们需要的点和它们的LCA建一棵树, 之后就可以在这棵树上进行dp等操作.

##### 虚树的构造

* 计算每个结点的dfs序. 记$x$点的dfs序为$dfn(x)$.
* 分别处理每组询问:
  * 将询问点按照dfs序升序排序.
  * 我们维护一个栈, 记录根节点到当前结点的路径.
  * 将根节点压入栈中.
  * 分别处理每一个询问点(记作$x$), 记栈顶元素为$top$, 栈顶第二个元素为$se$:
    * 如果栈中只有一个点, 直接将$x$压栈, 处理下一个点.
    * 计算$lca(x,top)$. 
    * 如果$dfn(se)\ge dfn(lca)$, 连边<$se,top$>, 将$top$出栈, 并重复这一步.
    * 如果$lca$不是栈顶, 连边<$lca,top$>, 将$top$改为$lca$.
    * 将$x$压栈.
  * 如果栈中有至少2个点, 连边<$se,top$>, 将$top$出栈, 并重复这一步.

至此, 虚树构建完成. 实际处理时可能需要用倍增维护边权信息.



#### 例题

luogu 2495 [SDOI2011]消耗战

###### 题意

给定一棵带边权的树. 把一条边割掉的代价等于边权.

给定多次询问, 每次询问给定若干个询问点, 求使这些关键点与根节点断开连接所需要的最小代价.

###### 题解

建出虚树, 虚树中边<$u,v$>的边权为原树中路径$u,v$上的最小边权. 直接dp即可.