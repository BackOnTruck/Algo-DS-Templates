## FWT

#### 目的

给定$\{a_n\},\{b_n\}$ ($n$是$2$的幂次), 求$\{c_n\}$, 满足$c_k=\sum_{i\oplus j=k}a_ib_j$. $\oplus$代表或($\or$), 与($\and$), 异或($\oplus$), 同或($\odot$)运算之一.

类比FFT, 我们需要一种序列变换$T(A)​$, 使得$T(C)=T(A\times B)=T(A)T(B)​$. 还需要一种逆变换$T^{-1}​$来计算$C​$.

我们定义$A,B$为将序列$A$和$B$拼接得到的新序列. 定义$A_0$, $A_1$分别表示序列$A$的前一半和后一半. 显然, $A$的前一半的下标的二进制首位为$0$, 后一半下标的二进制首位为$1$.

定义$A+B=C$, $AB=D$, 其中$c_i=a_i+b_i,~d_i=a_ib_i$. 卷积表示为$A\times B$.

##### 或 ($\or$)

$$
T(A)=T(A_0),T(A_1)+T(A_0)\\T^{-1}(A)=T^{-1}(A_0),T^{-1}(A_1)-T^{-1}(A_0)
$$

##### 与 ($\and$)

$$
T(A)=T(A_0)+T(A_1),T(A_1)\\T^{-1}(A)=T^{-1}(A_0)-T^{-1}(A_1),T^{-1}(A_1)
$$

##### 异或 ($\oplus$)

$$
T(A)=T(A_0)+T(A_1),T(A_0)-T(A_1)\\T^{-1}(A)=\frac {T^{-1}(A_0)+T^{-1}(A_1)}2,\frac {T^{-1}(A_0)-T^{-1}(A_1)}2
$$

##### 同或 ($\odot$)

$$
T(A)=T(A_1)-T(A_0),T(A_1)+T(A_0)\\T^{-1}=\frac{T^{-1}(A_1)-T^{-1}(A_0)}2,\frac{T^{-1}(A_1)+T^{-1}(A_0)}2
$$

####证明

下面给出**或**运算的证明. **与**, **异或**, **同或**运算证明类似.

我们需要证明
$$
T(C)=T(A\times B)=T(A)T(B)
$$
利用归纳法证明. $n=1$时显然.

假设$n=2^{k-1}$时结论成立. 

则有
$$
T(A_0\times B_0)=T(A_0)T(B_0)\\T(A_0\times B_1)=T(A_0)T(B_1)\\T(A_1\times B_0)=T(A_1)T(B_0)\\T(A_1\times B_1)=T(A_1)T(B_1)
$$
我们考虑$n=2^k$时的情况.

注意到
$$
A\times B=A_0\times B_0,A_1\times B_0+A_0\times B_1+A_1\times B_1
$$
则有
$$
T(A\times B)=T(A_0\times B_0),T(A_1\times B_0+A_0\times B_1+A_1\times B_1)+T(A_0\times B_0)
$$

$$
T(A)T(B)=(T(A_0),T(A_1)+T(A_0))(T(B_0),T(B_1)+T(B_0))\\=T(A_0)T(B_0),T(A_0\times B_0+A_1\times B_0+A_0\times B_1+A_1\times B_1)
$$

二者显然相等.

对于$T^{-1}$, 证法类似.